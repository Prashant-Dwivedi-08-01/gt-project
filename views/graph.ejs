<head>

    <style>
        body {
            margin: 0;
        }
    </style>

    <script src="//unpkg.com/force-graph"></script>
    <!--<script src="../../dist/force-graph.js"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>
    <nav class="navbar navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="#">
                <p style="font-weight: bold; display: inline; margin-right: 5px">Crime Scene</p>
                <img src="/images/nav_icon.png" alt="" width="30" height="24">

            </a>
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col-12">
                <form id="nodes" style="display: flex; align-items: center; flex-direction: column;">
                    <div class="mb-3">
                        <label for="exampleInputEmail1" class="form-label">Enter Number of Suspects</label>
                        <input type="number" class="form-control" id="n_nodes" aria-describedby="emailHelp">
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>


    <div class="container">
        <div class="row">
            <div class="col-12">
                <form id="person-interrogation" style="display: flex; align-items: center; flex-direction: column;">
                    <!-- <input type="number" name="nodes" placeholder="Number of people" id="n_nodes"> -->
                    <div id="input-canvas" style="display: flex; align-items: center; justify-content: center; flex-wrap: wrap;">
                        
                        <!-- <div class="mb-3 mx-2">
                            <label for="exampleInputEmail1" class="form-label">Suspect 1</label>
                            <select class="form-select" aria-label="Default select example">
                                <option selected>Open this select menu</option>
                                <option value="1">One</option>
                                <option value="2">Two</option>
                                <option value="3">Three</option>
                            </select>
                        </div>-->

                    </div>

                    <button type="submit" class="btn btn-primary" id="create-graph-btn" style="display:none">Create Graph</button>
                </form>
            </div>
        </div>
    </div>


    <div id="graph" style="display: flex; justify-content: center; border-radius: 8px;"></div>

    <script>

        document.getElementById('nodes').addEventListener('submit', function (e) {
            e.preventDefault();
            console.log('submitted');
            let n = document.getElementById('n_nodes').value
            let input_canvas = document.getElementById('input-canvas');
            for (let i = 1; i <= n; i++) {

                let wrapper = document.createElement('div');
                wrapper.className = 'mb-3 mx-2';

                let label = document.createElement('label');
                label.for = 'Suspect' + i;
                label.innerHTML = 'Suspect ' + i;
                label.className = 'form-label';

                let select = document.createElement('select');
                select.className = 'form-select';
                select.name = 'person' + i;
                select.setAttribute("multiple", "multiple")
                select.setAttribute("aria-label", "Default select example")
                select.id = 'suspect' + i;

                let option = document.createElement('option');
                option.setAttribute("selected", "selected");
                option.innerHTML = 'Who are telling the truth?';
                select.appendChild(option);

                for (let j = 1; j <= n; j++) {
                    if (j == i) continue;
                    let option = document.createElement('option');
                    option.value = j;
                    option.innerHTML = 'Suspect ' + j;
                    select.appendChild(option);
                }

                wrapper.appendChild(label);
                wrapper.appendChild(select);
                input_canvas.appendChild(wrapper);

                document.getElementById('create-graph-btn').style.display = 'block';
                
            }
        });


        let person_interrogation = document.getElementById('person-interrogation');
        person_interrogation.addEventListener('submit', function (e) {
            e.preventDefault();
            let n = document.getElementById('n_nodes').value
            let input_canvas = document.getElementById('input-canvas');
            let interrogation_result = {}

            for (let i = 1; i <= n; i++) {
                let person_select = document.getElementById('suspect' + i);
                let selected_options = $(person_select).val();
                interrogation_result['suspect' + i] = selected_options;
            }


            const gData_1 = {
                nodes: [],
                links: []
            }

            for (let i = 1; i <= n; i++) {

                // nodes
                gData_1.nodes.push({
                    id: i,
                    name: 'Suspect ' + i
                })

                // links of a node
                for (let j = 1; j <= interrogation_result['suspect' + i].length; j++) {
                    gData_1.links.push({
                        source: i,
                        target: parseInt(interrogation_result['suspect' + i][j])
                    })
                }
            }

            console.log(gData_1);

            // Random tree
            // const gData = {
            //     //   nodes: [...Array(N).keys()].map(i => ({ id: i })),
            //     nodes: [
            //         {
            //             id: 1,
            //             name: "One"
            //         },
            //         {
            //             id: 2,
            //             name: "Two"
            //         },
            //         {
            //             id: 3,
            //             name: "Three"
            //         },
            //         {
            //             id: 4,
            //             name: "Four"
            //         },
            //     ],
            //     links: [
            //         {
            //             source: 1,
            //             target: 2
            //         },
            //         {
            //             source: 1,
            //             target: 3
            //         },
            //         {
            //             source: 3,
            //             target: 4
            //         },
            //     ]
            // };

            const Graph = ForceGraph()
                (document.getElementById('graph'))
                .linkDirectionalParticles(2)
                .graphData(gData_1)
                .nodeLabel('name')
                .width(500)
                .height(500)
                .backgroundColor("#cbcbcb");
        });


    </script>
</body>